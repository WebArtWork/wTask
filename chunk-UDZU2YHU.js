import{a as M}from"./chunk-2EWNXXZ2.js";import{a as T}from"./chunk-7LGE3TYT.js";import{e as b}from"./chunk-UIH4WJTY.js";import{$a as j,E as o,F as p,G as m,Ja as g,L as f,La as k,Pa as v,R as u,Wa as w,c as n,gb as y,m as _,nb as C,pb as S}from"./chunk-CBKWH2IW.js";import{g as h}from"./chunk-GAL4ENT6.js";var c=(()=>{class r{constructor(t,s,i,a,l,R,I){this._translate=t,this._taskService=s,this._route=i,this._alert=a,this._form=l,this._core=R,this._router=I,this.columns=["name","description"],this.form=this._form.getForm("task",M),this.config={paginate:this.setRows.bind(this),perPage:20,setPerPage:this._taskService.setPerPage.bind(this._taskService),allDocs:!1,create:this._router.url.includes("tasks/")?()=>{this._form.modal(this.form,{label:"Create",click:(e,d)=>h(this,null,function*(){d(),this._preCreate(e),yield n(this._taskService.create(e)),this.setRows()})})}:null,update:e=>{this._form.modal(this.form,[],e).then(d=>{this._core.copy(d,e),this._taskService.update(e)})},delete:e=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this task?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>h(this,null,function*(){yield n(this._taskService.delete(e)),this.setRows()})}]})},buttons:[{icon:"task_alt",hrefFunc:e=>"/task/"+e._id},{icon:"cloud_download",click:e=>{this._form.modalUnique("task","url",e)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this.project_id="",this.release_id="",this.sprint_id="",this.tag_id="",this._page=1,this._route.paramMap.subscribe(e=>{this.project_id=e.get("project_id")||"",this.release_id=e.get("release_id")||"",this.sprint_id=e.get("sprint_id")||"",this.tag_id=e.get("tag_id")||"",this.setRows()})}setRows(t=this._page){this._page=t,this._core.afterWhile(this,()=>{this._taskService.get({page:t,query:this._query()}).subscribe(s=>{this.rows.splice(0,this.rows.length),this.rows.push(...s)})},250)}_bulkManagement(t=!0){return()=>{this._form.modalDocs(t?[]:this.rows).then(s=>h(this,null,function*(){if(t)for(let i of s)this._preCreate(i),yield n(this._taskService.create(i));else{for(let i of this.rows)s.find(a=>a._id===i._id)||(yield n(this._taskService.delete(i)));for(let i of s){let a=this.rows.find(l=>l._id===i._id);a?(this._core.copy(i,a),yield n(this._taskService.update(a))):(this._preCreate(i),yield n(this._taskService.create(i)))}}this.setRows()}))}}_preCreate(t){t.__created=!1,this.project_id&&(t.project=this.project_id),this.release_id&&(t.release=this.release_id),this.sprint_id&&(t.sprint=this.sprint_id),this.tag_id&&(t.tag=this.tag_id)}_query(){let t="";return this.project_id&&(t+=(t?"&":"")+"project="+this.project_id),this.release_id&&(t+=(t?"&":"")+"release="+this.release_id),this.sprint_id&&(t+=(t?"&":"")+"sprint="+this.sprint_id),this.tag_id&&(t+=(t?"&":"")+"tag="+this.tag_id),t}static{this.\u0275fac=function(s){return new(s||r)(o(y),o(T),o(g),o(j),o(S),o(w),o(k))}}static{this.\u0275cmp=p({type:r,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Tasks",3,"columns","config","rows"]],template:function(s,i){s&1&&u(0,"wtable",0),s&2&&f("columns",i.columns)("config",i.config)("rows",i.rows)},dependencies:[C],encapsulation:2})}}return r})();var q=[{path:"",component:c},{path:":project_id",component:c},{path:":project_id/release/:release_id",component:c},{path:":project_id/sprint/:sprint_id",component:c},{path:":project_id/tag/:tag_id",component:c}],H=(()=>{class r{static{this.\u0275fac=function(s){return new(s||r)}}static{this.\u0275mod=m({type:r})}static{this.\u0275inj=_({imports:[v.forChild(q),b]})}}return r})();export{H as TasksModule};
