import{e as j}from"./chunk-UIH4WJTY.js";import{$a as w,E as n,F as f,G as d,L as u,La as _,Pa as k,R as g,Wa as v,ab as C,c as r,gb as y,l as m,m as h,nb as b,pb as S}from"./chunk-CBKWH2IW.js";import{g as c}from"./chunk-GAL4ENT6.js";var P={formId:"taskpage",title:"Taskpage",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill taskpage title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill taskpage description"},{name:"Label",value:"Description"}]}]};var M=(()=>{class i extends C{constructor(){super({name:"taskpage"})}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var T=(()=>{class i{constructor(s,e,t,a,l,x){this._translate=s,this._taskpageService=e,this._alert=t,this._form=a,this._core=l,this._router=x,this.project_id=this._router.url.includes("pages/")?this._router.url.replace("/pages/",""):"",this.columns=["name","description"],this.form=this._form.getForm("taskpage",P),this.config={paginate:this.setRows.bind(this),perPage:20,setPerPage:this._taskpageService.setPerPage.bind(this._taskpageService),allDocs:!1,create:()=>{this._form.modal(this.form,{label:"Create",click:(o,p)=>c(this,null,function*(){p(),this._preCreate(o),yield r(this._taskpageService.create(o)),this.setRows()})})},update:o=>{this._form.modal(this.form,[],o).then(p=>{this._core.copy(p,o),this._taskpageService.update(o)})},delete:o=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this taskpage?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>c(this,null,function*(){yield r(this._taskpageService.delete(o)),this.setRows()})}]})},buttons:[{icon:"cloud_download",click:o=>{this._form.modalUnique("taskpage","url",o)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this._page=1,this.setRows()}setRows(s=this._page){this._page=s,this._core.afterWhile(this,()=>{this._taskpageService.get({page:s}).subscribe(e=>{this.rows.splice(0,this.rows.length),this.rows.push(...e)})},250)}_bulkManagement(s=!0){return()=>{this._form.modalDocs(s?[]:this.rows).then(e=>c(this,null,function*(){if(s)for(let t of e)this._preCreate(t),yield r(this._taskpageService.create(t));else{for(let t of this.rows)e.find(a=>a._id===t._id)||(yield r(this._taskpageService.delete(t)));for(let t of e){let a=this.rows.find(l=>l._id===t._id);a?(this._core.copy(t,a),yield r(this._taskpageService.update(a))):(this._preCreate(t),yield r(this._taskpageService.create(t)))}}this.setRows()}))}}_preCreate(s){s.__created,this.project_id&&(s.project=this.project_id)}static{this.\u0275fac=function(e){return new(e||i)(n(y),n(M),n(w),n(S),n(v),n(_))}}static{this.\u0275cmp=f({type:i,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Pages",3,"columns","config","rows"]],template:function(e,t){e&1&&g(0,"wtable",0),e&2&&u("columns",t.columns)("config",t.config)("rows",t.rows)},dependencies:[b],encapsulation:2})}}return i})();var R=[{path:"",component:T}],J=(()=>{class i{static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275mod=d({type:i})}static{this.\u0275inj=h({imports:[k.forChild(R),j]})}}return i})();export{J as PagesModule};
